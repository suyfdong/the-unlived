# 🔧 Google Analytics 修复说明

## ❌ 发现的问题

你在 Vercel 添加了环境变量并部署，但线上网站源代码中**没有 Google Analytics 脚本**。

### 原因
Google Analytics 组件被放在了 `<body>` 标签内，但 Next.js 的 `<Script>` 组件在 `<body>` 中无法正确渲染到 `<head>`。

---

## ✅ 已修复

我已经将 Google Analytics 组件移到了 `<head>` 标签内：

**文件**: [app/layout.tsx](app/layout.tsx:76-79)

```tsx
<head>
  {/* Google AdSense Script */}
  {process.env.NODE_ENV === 'production' && (
    <Script src="..." />
  )}

  {/* Google Analytics - 已修复位置 ✅ */}
  {process.env.NODE_ENV === 'production' && gaId && (
    <GoogleAnalytics measurementId={gaId} />
  )}
</head>
```

---

## 🚀 下一步：提交并重新部署

### 方法1：使用 Git 提交（推荐）

**步骤1：提交代码**
```bash
cd "/Users/susu/idea/AI 情绪博物馆/the-unlived"
git add .
git commit -m "Fix: Move Google Analytics to head tag"
git push
```

**步骤2：等待自动部署**
- Vercel 会自动检测到新提交并开始部署
- 等待 1-2 分钟

---

### 方法2：手动重新部署

如果你不想提交代码，可以先在 Vercel 手动重新部署测试：

1. 访问 https://vercel.com/
2. 找到项目 `the-unlived`
3. Deployments → 最新部署 → 三个点 `...` → Redeploy

**注意**：这种方法只是重新部署旧代码，**不包含我刚才的修复**。你仍然需要提交代码才能应用修复。

---

## 🎯 验证修复是否成功

部署完成后（约1-2分钟）：

### 步骤1：查看网站源代码
1. 访问 https://www.theunlived.art/
2. 右键 → 「查看网页源代码」
3. 按 `Ctrl+F` / `Cmd+F` 搜索：`G-X64N5PF0X0`

### 步骤2：应该看到的代码
修复成功后，你会在 `<head>` 标签内看到：

```html
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X64N5PF0X0"></script>
<script id="google-analytics">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-X64N5PF0X0', {
    page_path: window.location.pathname,
  });
</script>
```

---

## 📊 验证数据收集

### 方法1：浏览器开发者工具
1. 访问 https://www.theunlived.art/
2. 按 `F12` 打开开发者工具
3. 切换到 **Network（网络）** 标签
4. 刷新页面（`F5`）
5. 在网络请求列表搜索：`gtag` 或 `G-X64N5PF0X0`
6. 如果看到请求成功（状态码 200），说明配置正确！✅

### 方法2：Google Analytics 实时报告
1. 访问 https://analytics.google.com/
2. 选择你的网站属性
3. 左侧菜单：「报告」→「实时」
4. 打开新标签页访问你的网站
5. 回到 Google Analytics，等待 5-10 秒
6. 如果看到有 1 个用户（就是你自己），说明成功！✅

---

## 🆘 如果还是没有脚本

### 检查清单：

- [ ] Vercel 环境变量是否正确添加？
  - Key: `NEXT_PUBLIC_GA_MEASUREMENT_ID`
  - Value: `G-X64N5PF0X0`
  - Environment: `Production` ✅

- [ ] 代码是否已提交到 GitHub？
  ```bash
  git status  # 检查是否有未提交的更改
  ```

- [ ] Vercel 是否重新部署？
  - 最新部署的时间应该是在你提交代码之后

- [ ] 是否访问的正确域名？
  - 应该是 `https://www.theunlived.art/`
  - 不是 `http://localhost:3000`

---

## 📝 技术说明

### 为什么要放在 `<head>` 里？

1. **Google Analytics 要求**：追踪脚本必须在页面加载早期运行
2. **Next.js 限制**：`<body>` 中的 `<Script>` 组件无法插入到 `<head>`
3. **最佳实践**：所有追踪脚本应在 `<head>` 中加载

### 为什么本地看不到？

代码中设置了只在生产环境加载：
```tsx
{process.env.NODE_ENV === 'production' && gaId && (
  <GoogleAnalytics measurementId={gaId} />
)}
```

- **本地开发**：`NODE_ENV=development` → 不加载 ❌
- **Vercel 部署**：`NODE_ENV=production` → 加载 ✅

---

## ✅ 完成后

提交并部署成功后，请：

1. 验证网站源代码中有 Google Analytics 脚本
2. 在 Google Analytics 实时报告中看到自己的访问
3. 告诉我结果，我可以帮你进一步验证

---

**祝部署顺利！** 🚀
